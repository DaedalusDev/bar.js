!function(e){e.createObject("bar.store.articles",{1:{id:1,cat:1,label:"Coca-cola",desc:"Attention aux bulles !",prix:1,img:"coca.jpg"},2:{id:2,cat:1,label:"Coca zero",desc:"Les bulles sont sans sucre !",prix:1,img:"coca-zero.jpg"},3:{id:3,cat:1,label:"Jus d'orange",desc:"Quand c'est trop c'est tropico.",prix:1,img:"jus-orange.jpg"},4:{id:4,cat:1,label:"Jus de pomme",desc:"C'est trognon comme boisson.",prix:1,img:"jus-pomme.jpg"},5:{id:5,cat:1,label:"Jus d'abricot",desc:"Sans noyau.",prix:1,img:"jus-abricot.jpg"},6:{id:6,cat:1,label:"Jus d'ananas",desc:"Les ananas de la belle...",prix:1,img:"jus-ananas.jpg"},7:{id:7,cat:1,label:"Jus de pamplemousse",desc:"Meilleur avec du vin blanc.",prix:1,img:"jus-pamplemousse.jpg"},8:{id:8,cat:1,label:"Jus de tomate",desc:"La tomate est un fruit, c'est un fait.",prix:1,img:"jus-tomate.jpg"},9:{id:9,cat:1,label:"Jus de fraise",desc:"La boisson de charlotte.",prix:1,img:"jus-fraise.jpg"},10:{id:10,cat:1,label:"Orangina",desc:"Secouez, sinon la pulpe, elle reste en bas.",prix:1,img:"orangina.jpg"},11:{id:11,cat:1,label:"Schweppes agrum",desc:"What did you expect.",prix:1,img:"schweppes-agrum.jpg"},12:{id:12,cat:1,label:"Limonade",desc:"Bulle + citron + eau.",prix:1,img:"limonade.jpg"},13:{id:13,cat:1,label:"Perrier",desc:"Un sirop dedans ?",prix:1,img:"perrier.jpg"},14:{id:14,cat:1,label:"Evian",desc:"(De quel massif montagneux ca vient çà déjà ?)",prix:1,img:"evian.jpg"},15:{id:15,cat:1,label:"Cristaline",desc:"C'est clair",prix:.5,img:"cristaline.jpg"},16:{id:16,cat:1,label:"la Seinoise",desc:"Riche en urinium, et en oligo-excréments.",prix:.5,img:"seinoise.jpg"},17:{id:17,cat:2,label:"Grim (bouteille)",desc:"La bière des hommes",prix:1.5,img:"grimbergen.jpg"},18:{id:18,cat:2,label:"Grim Rouge",desc:"La bière des femmes",prix:1.5,img:"grim-rouge.jpg"},19:{id:19,cat:2,label:"1664",desc:"Idéal avant de retourner sur le chantier",prix:1.3,img:"1664-pression.jpg"},20:{id:20,cat:2,label:"1664 (bouteille)",desc:"Idéal avant de retourner sur le chantier",prix:1.5,img:"1664.jpg"},21:{id:21,cat:2,label:"Panaché",desc:"Servi avec panache !",prix:1.3,img:"panache.jpg"},22:{id:22,cat:2,label:"Monaco",desc:"Une peu de fruit pour les vitamines !",prix:1.3,img:"monaco.jpg"},23:{id:23,cat:2,label:"PCB",desc:"Un picon ch'tit biloute !",prix:1.8,img:"picon.jpg"},24:{id:24,cat:2,label:"Bière du mois",desc:"Selon arrivages",prix:1.5,img:"bdm.jpg"},25:{id:25,cat:3,label:"Martini",desc:"Martini dry... Avec ou sans olives ?",prix:1.5,img:"martini.jpg"},26:{id:26,cat:3,label:"Muscat",desc:"Une velle robe dorée",prix:1.5,img:"muscat.jpg"},27:{id:27,cat:3,label:"Pineau",desc:"À commander en charentaises",prix:1.5},28:{id:28,cat:3,label:"Rosé pamplemousse",desc:"Teneur en fruit non garantie",prix:1.4},29:{id:29,cat:3,label:"Vin blanc",desc:"Belle robe dorée",prix:1.4},30:{id:30,cat:3,label:"Vin mousseux",desc:"Le vin qui pique !",prix:1.4},31:{id:31,cat:3,label:"Cidre (75cl)",desc:"Mangez des pommes !",prix:5},32:{id:32,cat:3,label:"Kir vin blanc",prix:1.5},33:{id:33,cat:3,label:"Kir royal",desc:"Mure ou cassis ?",prix:1.5},34:{id:34,cat:4,label:"Chips",desc:"Le roi de la pomme de terre",prix:2,img:"chips.jpg"},35:{id:35,cat:4,label:"Saucisson",desc:'Préciser "A l\'ail" si possible',prix:2.9,img:"saucisson.jpg"},36:{id:36,cat:4,label:"Chorizo",desc:"Aux épices",prix:2.9},37:{id:37,cat:4,label:"Olives",desc:"Fraichement cueillies dans le bocal",prix:2},38:{id:38,cat:4,label:"Carre filet",desc:"Aucune idée mais c'est sur la carte....",prix:3.5},39:{id:39,cat:5,label:"Espresso",desc:"Du bon nectar.",prix:.5,img:"espresso.jpg"},40:{id:40,cat:5,label:"Double Espresso",desc:"Que j'aime ta couleur...",prix:1,img:"doubleEspresso.jpg"},41:{id:41,cat:5,label:"Décaféiné",desc:"C'est pas du café en gros ?",prix:.5,img:"decafeine.jpg"},42:{id:42,cat:5,label:"Chocolat",desc:"Le meilleurs c'est choky !",prix:.5,img:"chocolat.jpg"},43:{id:43,cat:5,label:"Capuccino",desc:"À l'italienne",prix:.5,img:"capuccino.jpg"},44:{id:44,cat:5,label:"Thé",desc:"Tea time",prix:.5,img:"the.jpg"}})}(O2),function(e){e.createObject("bar.store.categories",{1:{id:1,label:"Soft",icon:"&#xEB41;"},2:{id:2,label:"Binouzes",icon:"&#xE544;"},3:{id:3,label:"Boissons alcoolisées",icon:"&#xE540;"},4:{id:4,label:"Miam-miam",icon:"&#xE552;"},5:{id:5,label:"Boissons Chaudes",icon:"&#xE541;"}})}(O2),function(e){e.createObject("bar.store.users",{1:{id:1,label:"Daedalus",pref:[17]},2:{id:2,label:"Neo",pref:[17,1,9]},3:{id:3,label:"Priguns",pref:[17,1]},4:{id:4,label:"Reebox",pref:[2]},5:{id:5,label:"Ralphy",pref:[17,1]},6:{id:6,label:"Briscoto",pref:[17,1]},7:{id:7,label:"Alex",pref:[17,1]},8:{id:8,label:"Max",pref:[12]},9:{id:9,label:"Sam",pref:[17,1]},10:{id:10,label:"Loïc",pref:[17,1]},11:{id:11,label:"Damien",pref:[17,1]},12:{id:12,label:"Laurent F.",pref:[17,1]},13:{id:13,label:"Rémi F.",pref:[17,1]}})}(O2),function(e,a){a.createClass("bar.App",{oView:null,oCtrl:null,__construct:function(){this.oView=new bar.View,this.oCtrl=new bar.Ctrl(this.oView)}})}(jQuery,O2),function(e,a){a.createClass("bar.Commande",{id:null,_commande:null,_oCommande:null,prix:0,__construct:function(a){var t=this;this._commande={},this._oCommande={},void 0!==a&&e.isPlainObject(a)&&(this._oCommande=a,a.cmd&&e.each(a.cmd,function(e,a){var i=+a;i&&t.add(e,i)}),a.user&&a.user.forEach(function(e){t.add(e,1)}))},add:function(e,a){return this._commande[e]?this._commande[e]+=a:this._commande[e]=a,bar.store.articles[e]&&(this.prix+=bar.store.articles[e].prix*a),this},getCommande:function(){return e.map(this._commande,function(a,t){if(bar.store.articles[t]){var i=e.extend({},bar.store.articles[t]);return i.qt=a,i}})},getPrix:function(){return Math.round(100*this.prix)/100},toLocalStorage:function(){var e={};e[(new Date).toJSON()]=this._oCommande,bar.helper.storage.export(e)},_initDivision:function(e){if(void 0===e)throw"Un nombre de carte est requis";for(var a,t=[],i=0;i<e;i++)(a=new bar.Commande).id=i,t.push(a);return t},_tokenRing:function(e,a){var t;return e.forEach(function(e){if(e)for(var i=0;i<e.qt;i++)(t=a.reduce(bar.helper.reduce.byKey("prix"))).add(e.id,1)}),a},auPlusEquitable:function(e){var a=this._initDivision(e),t=this.getCommande();return t=t.sort(bar.helper.sort.byKey("prix",!0)),this._tokenRing(t,a),a}})}(jQuery,O2),function(e,a){a.createObject("bar.config",{STORAGE_KEY:"bar",API_URL:"localhost"===window.location.hostname?"api/web/app_dev.php/":"api/web/"})}(jQuery,O2),function(e,a){function t(){return{minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8"}}function i(e,a,i){function r(){A.empty()||(A.attr("transform","translate("+w(A.attr("T"))+",0)"),A.transition().duration(i.waveAnimateTime*(1-A.attr("T"))).ease(d3.easeLinear).attr("transform","translate("+w(1)+",0)").attr("T",1).on("end",function(){A.attr("T",0),r(i.waveAnimateTime)}))}null===i&&(i=t());var s,n=d3.select("#"+e);n.select("#liquid").attr("clip-path","url(#clipWave"+e+")");s=i.waveHeightScaling?d3.scaleLinear().range([0,i.waveHeight,0]).domain([0,50,100]):d3.scaleLinear().range([i.waveHeight,i.waveHeight]).domain([0,100]);var o=parseFloat(a).toFixed(2),l=12*i.circleThickness+12*i.circleFillGap,c=12-l,d=c*s(70),p=2*c/i.waveCount,u=1+i.waveCount,m=p*u,f=function(e){return Math.round(e)};parseFloat(o)!==parseFloat(f(o))&&(f=function(e){return parseFloat(e).toFixed(1)}),parseFloat(o)!==parseFloat(f(o))&&(f=function(e){return parseFloat(e).toFixed(2)});for(var b=[],g=0;g<=40*u;g++)b.push({x:g/(40*u),y:g/40});d3.scaleLinear().range([0,2*Math.PI]).domain([0,1]),d3.scaleLinear().range([0,12]).domain([0,12]);var v=d3.scaleLinear().range([0,m]).domain([0,1]),h=d3.scaleLinear().range([0,d]).domain([0,1]),x=d3.scaleLinear().range([l+2*c+d,l-d]).domain([0,1]),w=d3.scaleLinear().range([0,m-2*c]).domain([0,1]),y=n.append("g").attr("transform","translate(0,0)"),j=d3.area().x(function(e){return v(e.x)}).y0(function(e){return h(Math.sin(2*Math.PI*i.waveOffset*-1+2*Math.PI*(1-i.waveCount)+2*e.y*Math.PI))}).y1(function(e){return 2*c+d}),C=y.append("defs").append("clipPath").attr("id","clipWave"+e),A=C.append("path").datum(b).attr("d",j).attr("T",0),T=l+2*c-m;return i.waveRise?C.attr("transform","translate("+T+","+x(0)+")").transition().duration(i.waveRiseTime).attr("transform","translate("+T+","+x(.7)+")").on("start",function(){A.attr("transform","translate(1,0)")}):C.attr("transform","translate("+T+","+x(.7)+")"),i.waveAnimate&&r(),new function(){this.update=function(e){var a,t=Math.max(i.minValue,Math.min(i.maxValue,e))/i.maxValue,n=c*s(100*t),o=d3.scaleLinear().range([l+2*c+n,l-n]).domain([0,1])(t),d=d3.scaleLinear().range([0,m]).domain([0,1]),p=d3.scaleLinear().range([0,n]).domain([0,1]);a=i.waveHeightScaling?d3.area().x(function(e){return d(e.x)}).y0(function(e){return p(Math.sin(2*Math.PI*i.waveOffset*-1+2*Math.PI*(1-i.waveCount)+2*e.y*Math.PI))}).y1(function(e){return 2*c+n}):j;var u=i.waveAnimate?w(1):0;A.transition().duration(0).transition().duration(i.waveAnimate?i.waveAnimateTime*(1-A.attr("T")):i.waveRiseTime).ease(d3.easeLinear).attr("d",a).attr("transform","translate("+u+",0)").attr("T","1").on("end",function(){i.waveAnimate&&(A.attr("transform","translate("+w(0)+",0)"),r(i.waveAnimateTime))}),C.transition().duration(i.waveRiseTime).attr("transform","translate("+T+","+o+")")}}}a.createClass("bar.Ctrl",{$nbCarte:null,$diviser:null,$reset:null,$login:null,$glass:null,oView:null,__construct:function(a){var t=this;if(a){this.oView=a,this.$contentWrapper=e("#contentWrapper"),this.$reset=e("#resetBtn").on("click",function(){var e=t._serializeForm();t.$contentWrapper[0].reset(),t.$contentWrapper.trigger("change"),t.$contentWrapper.find("input").trigger("change"),Materializer.toast({toast:{message:"La commande a été vidée"},btn:[{label:"Annuler",color:"red",click:function(){t.$contentWrapper.deserializeObject(e)}}]})}),this.$nbCarte=e("#nbCarte"),this.$restore=e("#restoreBtn").on("click",function(){var e=bar.helper.storage.import();delete e.tmp,a.showHistory(e)}),this.$diviser=e("#diviserBtn").on("click",function(){var e=+t.$nbCarte.val(),i=t._serializeForm();i=new bar.Commande(i),a.showFacture(i,e)}),this.$login=e("#loginBtn").on("click",function(){var a=e('<div class="col s12">');if(bar.store.login)e('<form class="col s12 active"><div class="row"><div class="col s12"><a class="btn-floating waves-effect waves-light red right" id="logoutBtn"><i class="material-icons">&#xE2C1;</i></a></div><div class="input-field col s6"><input id="m-username" name="username" value="'+bar.store.login.username+'" type="text"><label for="m-username" class="active">Username</label></div><div class="input-field col s6"><input id="m-password" name="password" value="" type="password"><label for="m-password">Password (vide = pas de modification)</label></div><div class="input-field col s6"><input id="m-label" name="label" value="'+bar.store.login.label+'" type="text"><label for="m-label" class="active">Label</label></div><div class="input-field col s6"><input id="m-password2" value="" type="password"><label for="m-password2">Confirmez password</label></div><input class="hide" type="submit" /></div></form>').on("submit",function(a){a.preventDefault();var i=e(this),s=i.serializeObject();i.find("#m-password2").val()===s.password?(s.id=bar.store.login.id,s.password||delete s.password,t.flushProfile(s).done(function(){Materialize.toast("Votre profil à été mis à jour",2e3),t.oView.makeUserAddons(),r.modal("close")})):Materialize.toast("Les mots de passe ne sont pas identique",2e3)}).appendTo(a).find("#logoutBtn").on("click",function(){Materializer.ajax(bar.config.API_URL+"logout").done(function(){bar.store.login=null,Materialize.toast("Vous êtes déconnecté",2e3),r.modal("close")})});else{var i=e('<ul class="tabs tabs-fixed-width">').appendTo(a);e('<li class="tab col s3"><a href="#log">Login</a></li>').appendTo(i),e('<form id="log" class="col s12"><div class="row"><div class="input-field col s6"><input id="l-username" name="username" type="text"><label for="l-username">Login</label></div><div class="input-field col s6"><input id="l-password" name="password" type="password"><label for="l-password">Password</label></div><input class="hide" type="submit" /></div></form>').on("submit",function(a){a.preventDefault();var i=e(this).serializeArray();Materializer.ajax({url:bar.config.API_URL+"login",method:"POST",data:i}).done(function(a){bar.store.login=bar.store.users[a.id],bar.store.login=e.extend(bar.store.login,a);var i=bar.store.login.pref;Array.isArray(i)&&t.$contentWrapper.find('[name="fav[]"]').filter(function(){return-1!==i.indexOf(+this.value)}).prop("checked",!0).trigger("change"),Materialize.toast("Bonjour "+a.label,2e3),r.modal("close")})}).appendTo(a),e('<li class="tab col s3"><a href="#register">S\'enregistrer</a></li>').appendTo(i),e('<form id="register" class="col s12"><div class="row"><div class="input-field col s6"><input id="r-username" name="username" type="text"><label for="r-username">Login</label></div><div class="input-field col s6"><input id="r-password" name="password"  type="password"><label for="r-password">Password</label></div><input class="hide" type="submit" /></div></form>').on("submit",function(a){a.preventDefault();var i=e(this).serializeObject();i.username&&(i.label=i.username),t.flushProfile(i).done(function(e){Materialize.toast("Bienvenue "+e.label,2e3),t.oView.makeUserAddons(),r.modal("close")})}).appendTo(a)}var r=Materializer.createModal({content:a,type:"bottom-sheet with-tabs",footer:{Ok:{callback:function(e,a){a.on("click",function(){e.find("form.active").trigger("submit")})}}}})}),e(".help").on("click",function(e){e.preventDefault(),t.discover()});var i=null;this.$contentWrapper.on("change",function(){var a=t._serializeForm();e.isEmptyObject(a.cmd)&&delete a.cmd;var r=[];if(a.fav&&(r=a.fav,delete a.fav),bar.store.login){var s=bar.store.login;i&&clearTimeout(i),i=setTimeout(function(){JSON.stringify(s.pref)!==JSON.stringify(r.map(function(e){return+e}))&&t.flushProfile({id:s.id,pref:r.map(function(e){return{id:e}})}).done(function(){Materialize.toast("Vos favoris ont été persistés",2e3),t.oView.makeUserAddons()})},2e3)}e.isEmptyObject(a)?(t.$diviser.removeClass("scale-in").addClass("scale-out"),t.$reset.removeClass("scale-in").addClass("scale-out"),t.$restore.removeClass("scale-out").addClass("scale-in"),bar.helper.storage.export({tmp:null})):(t.$diviser.removeClass("scale-out").addClass("scale-in"),t.$reset.removeClass("scale-out").addClass("scale-in"),t.$restore.removeClass("scale-in").addClass("scale-out"),bar.helper.storage.export({tmp:a}))}),this.init()}},init:function(){var a=this;Materializer.ajax(bar.config.API_URL).done(function(t){bar.store=t,Materializer.ajax(bar.config.API_URL+"login").done(function(a){a&&(bar.store.login=bar.store.users[a.id],e.extend(bar.store.login,a),Materialize.toast("Bonjour "+a.label,2e3))}).always(function(){a.oView.showHome(),a.oView.makeUserAddons(),e('input[type="number"]').on("click",function(){this.select()}).on("change",function(){var a=e(this);+a.val()<0&&(Materialize.toast("Le bar ne fait pas crédit !",2e3),a.val(0));var t=a.closest(".collapsible-body"),i=t.find('input[type="number"]').serializeArray().reduce(function(e,a){return e+ +a.value},0);t.siblings(".collapsible-header").find(".badge").text(i||"")}),e("select").material_select();var t=bar.helper.storage.import();t?t.tmp&&(a.$contentWrapper.deserializeObject(t.tmp),Materialize.toast("Commande temporaire restaurée",2e3)):this.discover(),a.$contentWrapper.materializeLayout(),e(".splash").addClass("disappear")})}),a.easterEgg()},flushProfile:function(a){if(e.isPlainObject(a)){var t;return t=a.id?bar.config.API_URL+"user":bar.config.API_URL+"register",Materializer.ajax({url:t,method:"POST",data:JSON.stringify(a),contentType:"application/json"}).done(function(a){var t=bar.store.users[a.id];t?e.extend(t,a):bar.store.users[a.id]=bar.store.login=a})}return e.Deferred().reject({error:"Aucune données"}).promise()},_serializeForm:function(){var e=this.$contentWrapper.serializeObject(),a={};return e.cmd&&(e.cmd.forEach(function(e,t){"0"!==e&&(a[t]=e)}),e.cmd=a),e},discover:function(){var a;a=this.$diviser.hasClass("scale-in")?"diviser":"restore",e('.tap-target[data-activates="'+a+'"]').tapTarget("open")},easterEgg:function(){var a=t();a.circleColor="#FF7777",a.textColor="#FF4444",a.waveTextColor="#FFAAAA",a.waveColor="#d27001c8",a.circleThickness=.2,a.textVertPosition=.2,a.waveAnimateTime=1e3;var r=i("glass",28,a),s=this.$glass=e("#glass").one("click",function(){function e(u){null===t&&(t=u,r.update(1)),(l<c||d<l)&&(a=!0),u-t>=500*n&&r.update(p(++n/100)),a?(Materialize.toast("Score : "+parseInt(u-t)/1e3+"s",2e3),r.update(70),t=null,l=s.css("left",o).offset().left,a=!1,n=1,s.one("click",function(){requestAnimationFrame(e)})):(l+=Math.round(i),s.css("left",l),requestAnimationFrame(e))}var a=!1,t=null,i=0,n=1,o=s.css("left"),l=s.offset().left,c=-250,d=window.innerWidth,p=d3.interpolateNumber(40,80);window.addEventListener("deviceorientation",function(e){i=e.gamma*n}),requestAnimationFrame(e)})}})}(jQuery,O2),function(e,a){a.createObject("bar.helper",{pluralize:function(e){return Array.isArray(e)?e.length>1?"s":"":"string"==typeof e?e+"s":+e>1?"s":""},sort:{byKey:function(e,a){return a|=!1,function(t,i){return t[e]<i[e]?a?1:-1:t[e]>i[e]?a?-1:1:0}}},reduce:{byKey:function(e){return function(a,t){return a[e]<=t[e]?a:t}}},storage:{_getStorage:function(){var e=localStorage.getItem(bar.config.STORAGE_KEY);return e?JSON.parse(e):{}},_setStorage:function(e){localStorage.setItem(bar.config.STORAGE_KEY,JSON.stringify(e))},import:function(){return this._getStorage()},export:function(a){var t=e.extend(!0,{},a);for(var i in t)t[i]&&(t[i].hasOwnProperty("user")&&(t[i].user=e.extend({},t[i].user)),t[i].hasOwnProperty("cmd")&&(t[i].cmd=e.extend({},t[i].cmd)));var r=this._getStorage();e.extend(r,t);for(var s in r)r[s]||delete r[s];this._setStorage(r)}}}),Date.prototype.toFrench=function(){function e(e){return+e<10?"0"+e:e}var a=["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"];return e(this.getDate())+" "+a[this.getMonth()]+" "+this.getFullYear()+" à "+e(this.getHours())+":"+e(this.getMinutes())+":"+e(this.getSeconds())}}(jQuery,O2),function(e,a){a.createClass("bar.View",{$contentWrapper:null,__construct:function(){this.$contentWrapper=e("#contentWrapper")},showHome:function(){var a={},t=e('<ul class="collapsible" data-collapsible="expandable">').appendTo(e('<div class="col s12">').appendTo(this.$contentWrapper));e.each(bar.store.categories,function(i,r){var s=e('<div class="collapsible-body row">');a[r.id]=s,e('<li><div class="collapsible-header"><span class="badge"></span><i class="material-icons">'+r.icon+"</i>"+r.label+"</div></li>").appendTo(t).append(s)}),e.each(bar.store.articles,function(t,i){e('<div class="col s6 m3 artCard"><div class="card"><div class="card-image"><img class="activator" src="src/img/'+i.id+'.jpg"><div class="floatingArea"><a class="btn-floating waves-effect waves-light orange"><i class="material-icons">&#xE15B;</i></a><input type="number" name="cmd['+i.id+']" min="0" value="0"/><a class="btn-floating waves-effect waves-light blue add"><i class="material-icons">&#xE145;</i></a></div><div class="starswitch"><label class="btn-floating waves-effect white"><input type="checkbox" '+(bar.store.login&&-1!==bar.store.login.pref.indexOf(i.id)?'checked="checked"':"")+' name="fav[]" value="'+i.id+'"><i class="material-icons blue-text star">&#xE838;</i><i class="material-icons black-text">&#xE83A;</i></label></div></div><div class="card-content not-too-large"><span class="card-title activator black-text truncate">'+i.label+"</span><p>"+i.prix+'€<i class="material-icons activator right">more_vert</i></p></div><div class="card-reveal"><span class="card-title grey-text text-darken-4">'+i.label+'<i class="material-icons right">close</i></span><p>'+(i.desc||"Aucune description")+"</p></div></div></div>").appendTo(a[i.cat])}),this.$contentWrapper.find(".floatingArea .btn-floating").on("click",function(){var a=e(this),t=a.siblings("input");a.hasClass("add")?t.val(+t.val()+1):+t.val()-1>=0&&t.val(+t.val()-1),t.trigger("change")}),this.$contentWrapper.find(".starswitch input").on("change",function(){e(this);this.checked?e(this).attr("checked","checked"):e(this).attr("checked",null)}),t.collapsible()},makeUserAddons:function(){var a=null;if(e.isPlainObject(bar.store.users)){this.$userAddons&&(this.$contentWrapper.serializeObject().user&&(a={user:this.$contentWrapper.serializeObject().user}),this.$userAddons.remove());var t=this.$userAddons=e('<div class="input-field col s12">');e('<i class="material-icons prefix">&#xE8EF;</i>').appendTo(t);var i=e('<input data-target="quickBillModal" class="" readonly="true" data-activates="select-user-pref" value="Choisissez des participants..." type="text" />').appendTo(t),r=e('<div id="quickBillModal" class="modal bottom-sheet">').appendTo(t),s=e('<div class="modal-content">').appendTo(r),n=e('<ul class="modal-list">').appendTo(s),o=e();e.each(bar.store.users,function(a,t){e('<li class="optgroup"><span>'+t.label+"</span></li>").appendTo(n),Array.isArray(t.pref)&&t.pref.forEach(function(t){bar.store.articles[t]&&o.push(e('<li class="optgroup-option"><span><input type="checkbox" name="user['+a+']" value="'+t+'"><label></label>'+bar.store.articles[t].label+"</span></li>").appendTo(n)[0])})}),t.append('<label class="active">QuickBill</label>'),o.on("click",function(a){var t=e(this);if(a.stopPropagation(),a.preventDefault(),t.is(".optgroup-option:not(.disabled)")){var i=t.find('input[type="checkbox"]');i.prop("checked",function(e,a){return!a});i.trigger("change")}}).find('input[type="checkbox"]').on("change",function(){var a={},t=e(this),r=t.closest("li");t.prop("checked")?(r.addClass("active"),e().add(r.prevUntil(".optgroup",".active")).add(r.nextUntil(".optgroup",".active")).trigger("click")):r.removeClass("active"),o.filter(".active").each(function(){var t=e(this).text();a[t]=a[t]?a[t]+1:1});var s="";for(var n in a)s&&(s+=", "),s+=a[n]+" "+n;i.val(s||"Choisissez des participants...")}),this.$contentWrapper.on("reset",function(){o.removeClass("active")}),t.prependTo(this.$contentWrapper),i.on("click",function(){window.location.hash="quickBill"}),r.modal(),e(window).on("hashchange",function(){r.hasClass("open")&&"#quickBill"!==window.location.hash&&r.modal("close")}),a&&this.$contentWrapper.deserializeObject(a)}},_get$tab:function(a,t){var i={$tab:null,$content:null};i.$tab=e('<li class="tab col s3"><a href="#'+a+'">'+a+"</a></li>"),i.$content=e('<div id="'+a+'" class="col s12">'),i.$content.append("<h3>Total :"+t.getPrix()+"€<h3>");var r=e('<table class="striped bordered highlight">').appendTo(i.$content);return r.append("<tr><th>Article</th><th>Quantité</th><th>Prix</th></tr>"),t.getCommande().forEach(function(e){e&&e.qt&&r.append("<tr><td>"+e.label+"</td><td>"+e.qt+"</td><td>"+Math.round(e.qt*e.prix*100)/100+"€</td></tr>")}),i},_getAll$tab:function(e,a,t){var i=this,r=[];return r.push(this._get$tab("S",e)),a>1&&e[t](a).forEach(function(e){r.push(i._get$tab(e.id+1,e))}),r},showFacture:function(a,t,i){i=i||"auPlusEquitable";var r=e('<div class="col s12 fixed-tabs-wrapper">');if(t=~~t)if(t<0)Materialize.toast("Le bar ne fait pas crédit !",2e3);else{if(0!==a.getPrix()){var s=e('<ul class="tabs tabs-fixed-width">').appendTo(r);return this._getAll$tab(a,t,i).forEach(function(e){s.append(e.$tab),r.append(e.$content)}),Materializer.createModal({content:r,type:"modal-fixed-footer",footer:{Annuler:{classe:"modal-close"},"Enregistrer et vider":{callback:function(t,i){i.on("click",function(){a.toLocalStorage(),e("#resetBtn").trigger("click"),t.modal("close")})}},Enregistrer:{callback:function(e,t){t.on("click",function(){a.toLocalStorage(),e.modal("close")})}}}})}Materialize.toast("Votre commande est vide",2e3)}else Materialize.toast("Vous devez au moins avoir une carte",2e3)},showHistory:function(a){if(!e.isEmptyObject(a)){var t=e('<div class="col s12 fixed-tabs-wrapper">'),i=e('<ul class="collapsible" data-collapsible="expandable">').appendTo(t);for(var r in a)i.prepend(this._get$accordion(r,a[r]));var s=Materializer.createModal({content:t,type:"modal-fixed-footer",header:"Historique",footer:{Fermer:{classe:"modal-close"}}});return i.collapsible(),s}Materialize.toast("L'historique est vide",2e3)},_get$accordion:function(a,t){var i=this,r=e('<div class="collapsible-body col s12">'),s=new Date(a),n=s=s.toFrench();if(!e.isEmptyObject(t.user)){var o=0,l=e('<table class="striped bordered highlight">').appendTo(r);l.append('<tr><th style="width: 50%;">Habitué</th><th>Boisson</th></tr>'),e.each(t.user,function(e,a){null!==a&&(l.append("<tr><td>"+bar.store.users[e].label+"</td><td>"+bar.store.articles[a].label+"</td></tr>"),o++)}),n+=" - "+o+" habitué"+bar.helper.pluralize(o)}if(!e.isEmptyObject(t.cmd)){var c=0,d=e('<table class="striped bordered highlight">').appendTo(r);d.append('<tr><th style="width: 50%;">Article</th><th>Quantité</th></tr>'),e.each(t.cmd,function(e,a){bar.store.articles[e]&&(d.append("<tr><td>"+bar.store.articles[e].label+"</td><td>"+a+"</td></tr>"),c++)}),n+=" - "+c+" complément"+bar.helper.pluralize(c)}var p=e('<div class="right-align">').prependTo(r);return e('<a class="btn btn-floating waves-effect waves-light btn red"><i class="material-icons right">&#xE92B;</i></a>').appendTo(p).on("click",function(){var t=e(this).closest("li.active"),i=t.closest(".collapsible");i.collapsible("close",i.find("li").index(t)),Vel(t,{opacity:0,marginLeft:"-50%",height:0},{duration:375,easing:"easeOutExpo",queue:!1,delay:375,complete:function(){t.addClass("hide")}});var r={};r[a]=null,bar.helper.storage.export(r)}),e('<a class="btn btn-floating waves-effect waves-light btn green"><i class="material-icons right">&#xE889;</i></a>').appendTo(p).on("click",function(){i.$contentWrapper.deserializeObject(t),e(this).closest(".modal").modal("close"),Materialize.toast("Restauration terminée !",2e3)}),e('<li><div class="collapsible-header truncate"><i class="material-icons">&#xE889;</i>'+n+"</div></li>").append(r)}})}(jQuery,O2);