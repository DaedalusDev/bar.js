!function(a){a.createObject("bar.store.articles",[{id:0,cat:0,label:"Coca-cola",desc:"Attention aux bulles !",prix:1,img:"coca.jpg"},{id:1,cat:0,label:"Coca zero",desc:"Les bulles sont sans sucre !",prix:1,img:"coca-zero.jpg"},{id:2,cat:0,label:"Jus d'orange",desc:"Quand c'est trop c'est tropico.",prix:1,img:"jus-orange.jpg"},{id:3,cat:0,label:"Jus de pomme",desc:"C'est trognon comme boisson.",prix:1,img:"jus-pomme.jpg"},{id:4,cat:0,label:"Jus d'abricot",desc:"Sans noyau.",prix:1,img:"jus-abricot.jpg"},{id:5,cat:0,label:"Jus d'ananas",desc:"Les ananas de la belle...",prix:1,img:"jus-ananas.jpg"},{id:6,cat:0,label:"Jus de pamplemousse",desc:"Meilleur avec du vin blanc.",prix:1,img:"jus-pamplemousse.jpg"},{id:7,cat:0,label:"Jus de tomate",desc:"La tomate est un fruit, c'est un fait.",prix:1,img:"jus-tomate.jpg"},{id:8,cat:0,label:"Jus de fraise",desc:"La boisson de charlotte.",prix:1,img:"jus-fraise.jpg"},{id:9,cat:0,label:"Orangina",desc:"Secouez, sinon la pulpe, elle reste en bas.",prix:1,img:"orangina.jpg"},{id:10,cat:0,label:"Schweppes agrum",desc:"What did you expect.",prix:1,img:"schweppes-agrum.jpg"},{id:11,cat:0,label:"Limonade",desc:"Bulle + citron + eau.",prix:1,img:"limonade.jpg"},{id:12,cat:0,label:"Perrier",desc:"Un sirop dedans ?",prix:1,img:"perrier.jpg"},{id:13,cat:0,label:"Evian",desc:"(De quel massif montagneux ca vient çà déjà ?)",prix:1,img:"evian.jpg"},{id:14,cat:0,label:"Cristaline",desc:"C'est clair",prix:.5,img:"cristaline.jpg"},{id:15,cat:0,label:"la Seinoise",desc:"Riche en urinium, et en oligo-excréments.",prix:.5,img:"seinoise.jpg"},{id:16,cat:1,label:"Grim (bouteille)",desc:"La bière des hommes",prix:1.5,img:"grimbergen.jpg"},{id:17,cat:1,label:"Grim Rouge",desc:"La bière des femmes",prix:1.5,img:"grim-rouge.jpg"},{id:18,cat:1,label:"1664",desc:"Idéal avant de retourner sur le chantier",prix:1.3,img:"1664-pression.jpg"},{id:19,cat:1,label:"1664 (bouteille)",desc:"Idéal avant de retourner sur le chantier",prix:1.5,img:"1664.jpg"},{id:20,cat:1,label:"Panaché",desc:"Servi avec panache !",prix:1.3,img:"panache.jpg"},{id:21,cat:1,label:"Monaco",desc:"Une peu de fruit pour les vitamines !",prix:1.3,img:"monaco.jpg"},{id:22,cat:1,label:"PCB",desc:"Un picon ch'tit biloute !",prix:1.8,img:"picon.jpg"},{id:23,cat:1,label:"Bière du mois",desc:"Selon arrivages",prix:1.5,img:"bdm.jpg"},{id:24,cat:2,label:"Martini",desc:"Martini dry... Avec ou sans olives ?",prix:1.5,img:"martini.jpg"},{id:25,cat:2,label:"Muscat",desc:"Une velle robe dorée",prix:1.5,img:"muscat.jpg"},{id:26,cat:2,label:"Pineau",desc:"À commander en charentaises",prix:1.5},{id:27,cat:2,label:"Rosé pamplemousse",desc:"Teneur en fruit non garantie",prix:1.4},{id:28,cat:2,label:"Vin blanc",desc:"Belle robe dorée",prix:1.4},{id:29,cat:2,label:"Vin mousseux",desc:"Le vin qui pique !",prix:1.4},{id:30,cat:2,label:"Cidre (75cl)",desc:"Mangez des pommes !",prix:5},{id:31,cat:2,label:"Kir vin blanc",prix:1.5},{id:32,cat:2,label:"Kir royal",desc:"Mure ou cassis ?",prix:1.5},{id:33,cat:3,label:"Chips",desc:"Le roi de la pomme de terre",prix:2,img:"chips.jpg"},{id:34,cat:3,label:"Saucisson",desc:'Préciser "A l\'ail" si possible',prix:2.9,img:"saucisson.jpg"},{id:35,cat:3,label:"Chorizo",desc:"Aux épices",prix:2.9},{id:36,cat:3,label:"Olives",desc:"Fraichement cueillies dans le bocal",prix:2},{id:37,cat:3,label:"Carre filet",desc:"Aucune idée mais c'est sur la carte....",prix:3.5},{id:38,cat:4,label:"Espresso",desc:"Du bon nectar.",prix:.5,img:"espresso.jpg"},{id:39,cat:4,label:"Double Espresso",desc:"Que j'aime ta couleur...",prix:1,img:"doubleEspresso.jpg"},{id:40,cat:4,label:"Décaféiné",desc:"C'est pas du café en gros ?",prix:.5,img:"decafeine.jpg"},{id:41,cat:4,label:"Chocolat",desc:"Le meilleurs c'est choky !",prix:.5,img:"chocolat.jpg"},{id:42,cat:4,label:"Capuccino",desc:"À l'italienne",prix:.5,img:"capuccino.jpg"},{id:43,cat:4,label:"Thé",desc:"Tea time",prix:.5,img:"the.jpg"}])}(O2),function(a){a.createObject("bar.store.categories",[{label:"Soft",icon:"&#xEB41;"},{label:"Binouzes",icon:"&#xE544;"},{label:"Boissons alcoolisées",icon:"&#xE540;"},{label:"Miam-miam",icon:"&#xE552;"},{label:"Boissons Chaudes",icon:"&#xE541;"}])}(O2),function(a){a.createObject("bar.store.users",[{name:"Daedalus",pref:[16]},{name:"Neo",pref:[16,0,8]},{name:"Priguns",pref:[16,0]},{name:"Reebox",pref:[2]},{name:"Ralphy",pref:[16,0]},{name:"Briscoto",pref:[16,0]},{name:"Alex",pref:[16,0]},{name:"Max",pref:[12]},{name:"Sam",pref:[16,0]},{name:"Loïc",pref:[16,0]},{name:"Damien",pref:[16,0]},{name:"Laurent F.",pref:[16,0]}])}(O2),function(a,b){b.createClass("bar.App",{oView:null,oCtrl:null,__construct:function(){this.oView=new bar.View,this.oCtrl=new bar.Ctrl(this.oView)}})}(jQuery,O2),function(a,b){b.createClass("bar.Commande",{id:null,_commande:null,_oCommande:null,__construct:function(b){var c=this;this._commande=[],this._oCommande={};for(var d=0;d<bar.store.articles.length;d++)this._commande[d]=0;void 0!==b&&a.isPlainObject(b)&&(this._oCommande=b,b.cmd&&b.cmd.forEach(function(a,b){c._commande[b]+=+a}),b.user&&b.user.forEach(function(a){++c._commande[a]}))},add:function(a,b){return this._commande[a]?this._commande[a]+=b:this._commande[a]=b,this},getCommande:function(){var b=a.extend(!0,[],bar.store.articles);return aCommande=this._commande.map(function(a,c){return b[c].qt=a,b[c]}),aCommande},getPrix:function(){var a=0;return 0!=this._commande.length&&(a=this._commande.reduce(function(a,b,c){return b&&(a+=bar.store.articles[c].prix*b),a})),Math.round(100*a)/100},toLocalStorage:function(){var a=(new Date).toJSON(),b={};b[a]=this._oCommande,bar.helper.storage.export(b)},_initDivision:function(a){if(void 0===a)throw"Un nombre de carte est requis";for(var b,c=[],d=0;d<a;d++)b=new bar.Commande,b.id=d,c.push(b);return c},_tokenRing:function(a,b){var c;return a.forEach(function(a){if(a)for(var d=0;d<a.qt;d++)c=b.reduce(bar.helper.reduce.byMethod("getPrix")),c.add(a.id,1)}),b},auPlusEquitable:function(a){var b=this._initDivision(a),c=this.getCommande();return c=c.sort(bar.helper.sort.byKey("prix")),this._tokenRing(c,b),b}})}(jQuery,O2),function(a,b){b.createObject("bar.config",{STORAGE_KEY:"bar"})}(jQuery,O2),function(a,b){b.createClass("bar.Ctrl",{$nbCarte:null,$diviser:null,$reset:null,oView:null,__construct:function(b){var c=this;b&&(this.oView=b,this.$contentWrapper=a("#contentWrapper"),this.$reset=a("#reset").on("click",function(){var b=c.$contentWrapper.serializeObject();c.$contentWrapper[0].reset(),c.$contentWrapper.trigger("change");var d=a("<span>La commande a été vidée </span>");a("<a>Annuler</a>").appendTo(d).on("click",function(){c.$contentWrapper.deserializeObject(b),Vel(a(this).closest(".toast"),{opacity:0,marginTop:"-40px"},{duration:375,easing:"easeOutExpo",queue:!1})}),Materialize.toast(d,4e3)}),this.$nbCarte=a("#nbCarte"),this.$restore=a("#restore").on("click",function(){var a=bar.helper.storage.import();b.showHistory(a)}),this.$diviser=a("#diviser").on("click",function(){var a=+c.$nbCarte.val(),d=c.$contentWrapper.serializeObject();d=new bar.Commande(d),b.showFacture(d,a)}),a("input[type=number]").on("click",function(){this.select()}).on("change",function(){+a(this).val()<0&&(Materialize.toast("Le bar ne fait pas crédit !",2e3),a(this).val(0))}),a("select").material_select(),a(".splash").addClass("disappear"),a(".help").on("click",function(a){a.preventDefault(),c.discover()}),localStorage.getItem("bar")||this.discover(),this.$contentWrapper.on("change",function(){var b=c._serializeForm();a.isEmptyObject(b)?(c.$diviser.removeClass("scale-in").addClass("scale-out"),c.$reset.removeClass("scale-in").addClass("scale-out"),c.$restore.removeClass("scale-out").addClass("scale-in")):(c.$diviser.removeClass("scale-out").addClass("scale-in"),c.$reset.removeClass("scale-out").addClass("scale-in"),c.$restore.removeClass("scale-in").addClass("scale-out"))}))},_serializeForm:function(){var a=this.$contentWrapper.serializeObject();return a.cmd&&(a.cmd=a.cmd.filter(function(a){return+a}),a.cmd.length||delete a.cmd),a},discover:function(){var b;b=this.$diviser.hasClass("scale-in")?"diviser":"restore",a('.tap-target[data-activates="'+b+'"]').tapTarget("open")}})}(jQuery,O2),function(a,b){b.createObject("bar.helper",{pluralize:function(a){return Array.isArray(a)?a.length>1?"s":"":+a>1?"s":""},delete:{null:function(a,b,c){null===a&&delete c[b]},zero:function(a,b,c){"0"!==a.toString()&&delete c[b]},empty:function(a,b,c){+a||delete c[b]}},filter:{null:function(a){return null!==a},zero:function(a){return"0"!==a.toString()},empty:function(a){return+a}},sort:{byKey:function(a){return function(b,c){return b[a]>c[a]?-1:b[a]<c[a]?1:0}}},reduce:{byMethod:function(a){return function(b,c){return b[a]()<=c[a]()?b:c}}},storage:{_getStorage:function(){var a=localStorage.getItem(bar.config.STORAGE_KEY);return a?JSON.parse(a):{}},_setStorage:function(a){localStorage.setItem(bar.config.STORAGE_KEY,JSON.stringify(a))},import:function(){var a,b=this._getStorage();for(var c in b)b.hasOwnProperty(c)&&(a=b[c],a.user&&a.user.forEach(bar.helper.delete.null),a.cmd&&a.cmd.forEach(bar.helper.delete.empty));return b},export:function(b){var c=this._getStorage();a.extend(!0,c,b),this._setStorage(c)}}})}(jQuery,O2),function(a,b){b.createClass("bar.View",{$contentWrapper:null,__construct:function(){this.$contentWrapper=a("#contentWrapper"),this.showHome()},showHome:function(){var b,c=[];this._makeUserAddons();var d=a('<ul class="collapsible" data-collapsible="expandable">').appendTo(a('<div class="col s12">').appendTo(this.$contentWrapper));bar.store.categories.forEach(function(e){b=a('<div class="collapsible-body col s12">'),c.push(b),a('<li><div class="collapsible-header"><i class="material-icons">'+e.icon+"</i>"+e.label+"</div></li>").appendTo(d).append(b)}),bar.store.articles.forEach(function(d){b=a('<div class="col s6 m3 artCard"><div class="card"><div class="card-image"><img class="activator" src="src/img/'+(d.img||"404.jpg")+'"><div class="floatingArea"><a class="btn-floating waves-effect waves-light orange"><i class="material-icons">&#xE15B;</i></a><input type="number" name="cmd['+d.id+']" min="0" value="0"/><a class="btn-floating waves-effect waves-light blue add"><i class="material-icons">&#xE145;</i></a></div></div><div class="card-content not-too-large"><span class="card-title activator black-text truncate">'+d.label+"</span><p>"+d.prix+'€<i class="material-icons activator right">more_vert</i></p></div><div class="card-reveal"><span class="card-title grey-text text-darken-4">'+d.label+'<i class="material-icons right">close</i></span><p>'+(d.desc||"Aucune description")+"</p></div></div></div>").appendTo(c[d.cat])}),this.$contentWrapper.find(".floatingArea .btn-floating").on("click",function(){var b=a(this),c=b.siblings("input");if(b.hasClass("add"))c.val(+c.val()+1);else{+c.val()-1>=0&&c.val(+c.val()-1)}b.trigger("change")}),d.collapsible()},_makeUserAddons:function(){if(bar.store.users.length){var b=a('<div class="input-field col s12">'),c=a('<div class="select-wrapper">').appendTo(b).append('<span class="caret">▼</span>'),d=a('<input class="select-dropdown" readonly="true" data-activates="select-user-pref" value="Choisissez des participants..." type="text" />').appendTo(c),e=a('<ul id="select-user-pref" class="dropdown-content select-dropdown multiple-select-dropdown">').appendTo(c);e.append('<li class="optgroup-option disabled"><span><input type="checkbox" disabled><label></label>Choisissez des participants...</span></li>'),bar.store.users.forEach(function(b,c){a('<li class="optgroup"><span>'+(b.name||"???")+"</span></li>").appendTo(e),Array.isArray(b.pref)&&b.pref.forEach(function(b){bar.store.articles[b]&&a('<li class="optgroup-option"><span><input type="checkbox" name="user['+c+']" value="'+b+'"><label></label>'+bar.store.articles[b].label+"</span></li>").appendTo(e)})}),b.append("<label>QuickBill</label>");var f=e.find("li");f.on("click",function(b){var c=a(this);if(b.stopPropagation(),c.is(".optgroup-option:not(.disabled)")){var e=c.find('input[type="checkbox"]');e.prop("checked",function(a,b){return!b});e.trigger("change")}else c.is(".optgroup-option.disabled")&&d.dropdown("close")}).find('input[type="checkbox"]').on("change",function(){var b={};$this=a(this);var c=$this.closest("li");if($this.prop("checked")){c.addClass("active");a().add(c.prevUntil(".optgroup",".active")).add(c.nextUntil(".optgroup",".active")).trigger("click")}else c.removeClass("active");f.filter(".active").each(function(){var c=a(this).text();b[c]=b[c]?b[c]+1:1});var e="";for(var g in b)e&&(e+=", "),e+=1==b[g]?g:b[g]+" "+g;d.val(e||"Choisissez des participants...")}),this.$contentWrapper.on("reset",function(){f.removeClass("active")}),b.appendTo(this.$contentWrapper),d.dropdown()}},_get$tab:function(b,c){var d={$tab:null,$content:null};d.$tab=a('<li class="tab col s3"><a href="#'+b+'">'+b+"</a></li>"),d.$content=a('<div id="'+b+'" class="col s12">'),d.$content.append("<h3>Total :"+c.getPrix()+"€<h3>");var e=a('<table class="striped bordered highlight">').appendTo(d.$content);return e.append("<tr><th>Article</th><th>Quantité</th><th>Prix</th></tr>"),c.getCommande().forEach(function(a){a&&a.qt&&e.append("<tr><td>"+a.label+"</td><td>"+a.qt+"</td><td>"+Math.round(a.qt*a.prix*100)/100+"€</td></tr>")}),d},_getAll$tab:function(a,b,c){var d=this,e=[];return e.push(this._get$tab("S",a)),b>1&&a[c](b).forEach(function(a){e.push(d._get$tab(a.id+1,a))}),e},showFacture:function(b,c,d){d=d||"auPlusEquitable";var e=a('<div class="col s12 fixed-tabs-wrapper">');if(!(c=~~c))return void Materialize.toast("Vous devez au moins avoir une carte",2e3);if(c<0)return void Materialize.toast("Le bar ne fait pas crédit !",2e3);if(0==b.getPrix())return void Materialize.toast("Votre commande est vide",2e3);var f=a('<ul class="tabs tabs-fixed-width">').appendTo(e);this._getAll$tab(b,c,d).forEach(function(a){f.append(a.$tab),e.append(a.$content)}),Materializer.createModal({content:e,type:"modal-fixed-footer",footer:{Annuler:{classe:"modal-close"},"Enregistrer et vider":{callback:function(c,d){d.on("click",function(){b.toLocalStorage(),a("#reset").trigger("click"),c.modal("close")})}},Enregistrer:{callback:function(a,c){c.on("click",function(){b.toLocalStorage(),a.modal("close")})}}}})},showHistory:function(b){if(a.isEmptyObject(b))return void Materialize.toast("L'historique est vide",2e3);var c=a('<div class="col s12 fixed-tabs-wrapper">'),d=a('<ul class="collapsible" data-collapsible="expandable">').appendTo(c);for(var e in b)d.prepend(this._get$accordion(e,b[e]));Materializer.createModal({content:c,type:"modal-fixed-footer"}),d.collapsible()},_get$accordion:function(b,c){var d=this,e=a('<div class="collapsible-body col s12">'),b=new Date(b);b=b.toFrench();var f=b;if(c.user&&c.user.length){var g=c.user.filter(bar.helper.filter.null);if(g.length){f+=" - "+g.length+" habitué"+bar.helper.pluralize(g);var h=a('<table class="striped bordered highlight">').appendTo(e);h.append('<tr><th style="width: 50%;">Habitué</th><th>Boisson</th></tr>'),c.user.forEach(function(a,b){h.append("<tr><td>"+bar.store.users[b].name+"</td><td>"+bar.store.articles[a].label+"</td></tr>")})}}if(c.cmd&&c.cmd.length){var i=c.cmd.filter(bar.helper.filter.empty);if(i.length){f+=" - "+i.length+" complément"+bar.helper.pluralize(i);var j=a('<table class="striped bordered highlight">').appendTo(e);j.append('<tr><th style="width: 50%;">Article</th><th>Quantité</th></tr>'),c.cmd.forEach(function(a,b){j.append("<tr><td>"+bar.store.articles[b].label+"</td><td>"+a+"</td></tr>")})}}var k=a('<div class="right-align">').appendTo(e);return a('<a class="waves-effect waves-light btn green">Restaurer <i class="material-icons right">&#xE889;</i></a>').appendTo(k).on("click",function(){d.$contentWrapper.deserializeObject(c),a(this).closest(".modal").modal("close"),Materialize.toast("Restauration terminée !",2e3)}),a('<li><div class="collapsible-header"><i class="material-icons">&#xE889;</i>'+f+"</div></li>").append(e)}})}(jQuery,O2);